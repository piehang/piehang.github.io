<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Login</title>
</head>
<body>
<h2>请输入密码</h2>
<input type="password" id="p">
<button id="b">进入</button>
<p id="e" style="color:red;"></p>
<script>
const K = "a94b4c2f184927cc";
const IV = new Uint8Array(16);
const EP = "2/8RV4NG1X5BmLfGFncW6A==";
const ED = "H9owIIS67P5ZVKduz8sluQ==";

async function aesKey(key) {
  return crypto.subtle.importKey(
    "raw", 
    new TextEncoder().encode(key),
    "AES-CBC", 
    false, 
    ["encrypt", "decrypt"]
  );
}

async function decryptAES(base64, key) {
  const raw = Uint8Array.from(atob(base64), c => c.charCodeAt(0));
  const keyObj = await aesKey(key);
  const decrypted = await crypto.subtle.decrypt(
    { name: "AES-CBC", iv: IV },
    keyObj,
    raw
  );
  const decryptedArr = new Uint8Array(decrypted);
  const paddingLen = decryptedArr[decryptedArr.length - 1];
  const unpadded = decryptedArr.slice(0, decryptedArr.length - paddingLen);
  return new TextDecoder().decode(unpadded);
}

document.getElementById("b").onclick = async () => {
  const input = document.getElementById("p").value;
  const errorEl = document.getElementById("e");
  try {
    const pwd = await decryptAES(EP, K);
    if (input !== pwd) {
      errorEl.textContent = "密码错误";
      return;
    }
    const target = await decryptAES(ED, K);
    errorEl.textContent = "";
    window.location.href = target;
  } catch (err) {
    errorEl.textContent = "解密失败：" + err.message;
    console.error(err);
  }
};
</script>
</body>
</html>